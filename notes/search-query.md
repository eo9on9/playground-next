# 검색 화면과 URL 쿼리 연동

> 예시 코드 sources/search-user/SearchUserPage.tsx

## 왜 검색 화면에서 URL 쿼리와 연동해야 할까?

검색 조건을 “URL 쿼리 = 단일 진실의 원천(Single Source of Truth)”로 두면 사용자가 브라우저를 조작해도 UI 상태가 깨지지 않음.

| 이유                                        | 설명                                                                                                 |
| ------------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| 🔁 **새로고침/뒤로가기 복원성**             | 브라우저 내비게이션 히스토리에 쿼리가 남으므로, 뒤로가기를 눌러도 동일한 검색 결과를 다시 볼 수 있음 |
| 🔗 **링크 공유 가능성**                     | 특정 검색 조건이 반영된 URL을 복사/공유할 수 있음 (`/search?name=alice&city=seoul`)                  |
| 🔍 **서버 사이드 렌더링 시 즉시 검색 가능** | 쿼리가 서버로도 전달되므로, 서버에서 해당 조건으로 미리 데이터를 fetch 가능                          |
| 🧠 **상태 저장 없이 선언적 동작**           | “URL이 곧 상태(state)”이므로, 별도의 글로벌 스토어 없이도 검색 상태를 재현할 수 있음                 |

## 쿼리 연동을 위해 필요한 주요 처리

1. 폼 입력값을 URL로 반영하기
2. URL이 바뀔 때 폼 값 동기화
3. URL이 바뀔 때 검색 재요청

## 쿼리 연동 시 주의할 점

1. useSearchParams()는 클라이언트 하이드레이션 이후에야 실제 값을 가지므로 처음엔 null → 그 후 값이 생김. → if (!param) return 같은 방어 코드 필요.
2. 쿼리 직렬화 시 타입 보존 number → string으로, boolean은 'true' | 'false'로 변환해야 URL이 올바름. 특히 0은 falsy라서 누락되기 쉬움 → Number.isFinite()로 체크.
3. 폼 초기화 타이밍: 하이드레이션 직후 reset(queryObj) 호출 시 살짝 깜빡일 수 있음.
4. queryKey에 객체 그대로 넣을 경우 참조 변경으로 캐시가 무효화됨

## 동작 흐름

1. 사용자가 폼에 입력 후 검색 클릭
2. 입력값을 URLSearchParams로 변환 후 router.push
3. URL이 변경 → useSearchParams 갱신
4. 폼이 URL 쿼리로 reset()
5. React Query가 쿼리를 key로 검색 요청
6. 결과 표시
