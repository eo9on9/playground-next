# Token Refresh

## Token Refresh 과정

> 예시 코드 sources/auth/request.ts

### 로그인

1. 클라) 사용자가 로그인 폼 제출
2. 서버) 계정 확인 후 AccessToken: 토큰 응답, RefreshToken: httpOnly 쿠키 응답
3. 클라) AccessToken을 로컬 스토리지에 저장 (쿠키는 브라우저가 자동 저장하지만 JS에서는 접근 불가)

### 로그아웃

1. 클라) 사용자가 로그아웃 버튼 클릭
2. 서버) AccessToken, RefreshToken 삭제
3. 클라) 토큰 클리어

### 일반 요청

1. 요청 인터셉터에서 헤더에 AccessToken 추가해서 요청

### 일반 요청의 성공 응답

1. 응답 인터셉터에서 성공시에는 그대로 반환

### 일반 요청의 실패 응답 (토큰 만료)

1. 응답 인터셉터의 onRejected 콜백 실행
2. 전체 재시도 회수는 한번으로 설정
3. 토큰 리프레시에 대한 실패는 예외로 바로 실패 처리
4. 원본 요청의 토큰과 현재의 토큰을 한번 비교해서 다르면 리프레시 없이 바로 재시도

### 리프레시 요청

1. 토큰 리프레시 시도
2. 리프레시 프로미스가 있으면 기존 프로미스 같이 기다리고 아니면 새로운 프로미스 생성
3. 새로 받아온 토큰으로 원본 요청의 헤더 갈아서 재요청
